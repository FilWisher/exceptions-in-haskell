\chapter{Translations}

% TODO: try to lmu from van Bakel
%\section{\ltry-to-\lmu}
%
\section{\lmu-to-DCC}

% TODO: explain initial attempt and explain why it was simple and intuitive
%       and follow up with why it went wrong and what we had to change.
%       surprisingly did not work. replacing alpha in wsc terms to distribute
%       context throughout is why new one works

%\begin{figure}[!h]
%\definition{
%  \textsc{(Interpretation of \lmu\ into DCC)}
%  \[
%  \begin{array}{lcl}
%    \dbr{x}        & \triangleq & x \\
%    \dbr{`lx.M}    & \triangleq & `lx.\dbr{M} \\
%    \dbr{M N}      & \triangleq & \dbr{M} \dbr{N} \\
%    \dbr{`m`a.M}   & \triangleq & (`lp.\pp\ p\ \\
%    &&                 \hspace{1cm} ((\wsc\ p\ (`l`a.\dbr{M})) \\ 
%    &&                 \hspace{1cm} \dbr{N}) \\
%    &&               )\ \np \\
%    \dbr{[`b]M} & \triangleq & \psc\ `b\ \dbr{M}
%  \end{array}
%  \]
%}
%\end{figure}

The translation of a full program $M$ in the \lmu-calculus to DCC is
defined as $\dbr{M}_{p}$ where the subscript $p$ denotes the 
translation is initialized with prompt $p$. Formally, this means that
$\dbr{M}_{p} \triangleq (`lp.\pp\ p\ \dbr{M})\np$

\definition{
  \textsc{(Initialization of a translation of $M$ into DCC)}
  \[ \dbr{M}_{p} \triangleq (`lp.\pp\ p\ \dbr{M})\np \]
}

\definition{
  \textsc{(Interpretation of \lmu\ into DCC)}
  \[
  \begin{array}{lcl}
    \dbr{x}        & \triangleq & x \\
    \dbr{`lx.M}    & \triangleq & `lx.\dbr{M} \\
    \dbr{M N}      & \triangleq & \dbr{M} \dbr{N} \\
    \dbr{`m`a.M}   & \triangleq & \wsc\ p\ `l`a.\pp\ p\ \dbr{M} \\
    \dbr{[`b]M} & \triangleq & \psc\ `b\ \dbr{M}
  \end{array}
  \]
}

% TODO: Add proofs for completeness and other properties
\begin{theorem}[Soundness of $\dbr{\bullet}$]
If $M \rightarrow_{`m} N$ then $\dbr{M} \rightarrow_{DCC} \dbr{N}$
\end{theorem}

% TODO: separate D and E in DCC proofs 
\begin{proof}{By induction on the definition of $\rightarrow_{`m}$}
\[
\begin{array}{rlrl}
  \prooflabel{(`lx.M)N \to M[N/x]:} \\
               & \tr{(`lx.M)N} \\
    \triangleq & \tr{(`lx.M)} \tr{N} \\
    \triangleq & (`lx.\tr{M}) \tr{N} \\
    \tob\   & \tr{M}[\tr{N}/x] \\
\end{array} 
\]
\\
\[
\begin{array}{rlrl}
  \prooflabel{(`m`a.[`b]M)N \to `m`a.([`b]M)[[`a]M^\prime N/[`a]M^\prime]:} \\
             & \tr{(`m`a.[`b]M)N} \\
  \triangleq & \tr{(`m`a.[`b`]M)} \tr{N} \\
  \triangleq & (\wsc\ p\ `l`a. \pp\ p\ (\psc\ `b\ \tr{M})) \tr{N} & p:[] \\
  \todcc\ & \wsc\ p\ `l`a. \pp\ p\ (\psc\ `b\ \tr{M}) & \square \tr{N}:p:[] \\
  \todcc\ & (`l`a. \pp\ p\ (\psc\ `b\ \tr{M}))(\square\tr{N}) & [] \\
  \tob\ & (\pp\ p\ (\psc\ `b\ \tr{M}))[\square\tr{N}/`a] & [] \\
  \tob\ & \pp\ p\ (\psc\ `b\ (\tr{M}[\square\tr{N}/`a])) & [] \\
  \todcc\ & \psc\ `b\ (\tr{M}[\square\tr{N}/`a]) & p:[] \\
  \triangleq\ & \tr{`m`a.([`b]M)[[`a]M^\prime N/[`a]M^\prime]} \\
\end{array} 
\]
\\
\[
\begin{array}{rlrl}
  \prooflabel{`m`a.[`a]M \to M:} \\
              & \tr{`m`a.[`a]M} \\
   \triangleq & \wsc\ p\ `l`a.\pp\ p\ (\psc\ `a\ \tr{M}) & p:[] \\
   \todcc\    & `l`a.\pp\ p\ (\psc\ `a\ \tr{M})(\square) & [] \\
   \tob\      & \pp\ p\ (\psc\ `a\ \tr{M})[\square/`a] & [] \\
   \tob\      & \pp\ p\ (\psc\ \square\ (\tr{M}[\square/`a]) & [] \\
   \todcc\    & \psc\ \square\ (\tr{M}[\square/`a] & p:[] \\
   \todcc\    & \tr{M}[\square/`a] & p:[] \\
   \triangleq & \tr{M} \\
\end{array}
\]
\\ 
\[
\begin{array}{rlrl}
  \prooflabel{`m`a.[`b]`m`g.[`d]M \to `m`a.[`d](M[`b/`g]):} \\
    \triangleq & \wsc\ p\ `l`a.\pp\ p\ \tr{[`b]`m`g.[`d]M} & p:[] \\
    \todcc\    & `l`a.\pp\ p\ \tr{[`b]`m`g.[`d]M}(\square) & [] \\
    \tob\      & (\pp\ p\ \tr{[`b]`m`g.[`d]M})[\square/`a] & [] \\
    \tob\      & \pp\ p\ \tr{[`b]`m`g.[`d]M}[\square/`a] & [] \\
    \tob\      & \tr{[`b]`m`g.[`d]M}[\square/`a] & p:[] \\
    \triangleq & (psc `b \tr{`m`g.[`d]M})[\square/`a] & p:[] \\
    \triangleq & \tr{`m`g.[`d]M})[\square/`a] & `b:p:[] \\
    \triangleq & (\wsc\ p\ `l`g.\tr{[`d]M})[\square/`a] & `b:p:[] \\
    \triangleq & \wsc\ p\ `l`g.\pp\ p\ \tr{[`d]M}[\square/`a] & `b:p:[] \\
    \triangleq & (`l`g.\pp\ p\ \tr{[`d]M}[\square/`a])(`b) & [] \\
    \triangleq & (\pp\ p\ \tr{[`d]M}[\square/`a])[`b/`g] & [] \\
    \triangleq & \pp\ p\ (\tr{[`d]M}[\square/`a])[`b/`g] & [] \\
    \triangleq & \tr{[`d]M}[\square/`a])[`b/`g] & p:[] \\
    \triangleq & (\psc\ `d\ M[\square/`a][`b/`g] & p:[] \\
    \triangleq & \psc\ `d\ (M[\square/`a])[`b/`g] & p:[] \\
    \triangleq & \tr{`m`a.[`d](M[`b/`g])} & p:[] \\
\end{array}
\]
\\ 
\[
\begin{array}{rlrl}
  \prooflabel{`m`a.[`b]`m`g.[`g]M \to `m`a.[`b](M[`b/`g]):} \\
               & \tr{`m`a.[`b]`m`g.[`d]M} \\
    \triangleq & \wsc\ p\ `l`a.\pp\ p\ \tr{[`b]`m`g.[`d]M} & p:[] \\
    \todcc\    & `l`a.\pp\ p\ \tr{[`b]`m`g.[`d]M}(\square) & [] \\
    \tob\      & (\pp\ p\ \tr{[`b]`m`g.[`d]M})[\square/`a] & [] \\
    \tob\      & \pp\ p\ \tr{[`b]`m`g.[`d]M}[\square/`a] & [] \\
    \tob\      & \tr{[`b]`m`g.[`d]M}[\square/`a] & p:[] \\
    \triangleq & (psc `b \tr{`m`g.[`d]M})[\square/`a] & p:[] \\
    \triangleq & \tr{`m`g.[`d]M})[\square/`a] & `b:p:[] \\
    \triangleq & (\wsc\ p\ `l`g.\tr{[`d]M})[\square/`a] & `b:p:[] \\
    \triangleq & \wsc\ p\ `l`g.\pp\ p\ \tr{[`d]M}[\square/`a] & `b:p:[] \\
    \triangleq & (`l`g.\pp\ p\ \tr{[`d]M}[\square/`a])(`b) & [] \\
    \triangleq & (\pp\ p\ \tr{[`d]M}[\square/`a])[`b/`g] & [] \\
    \triangleq & \pp\ p\ (\tr{[`d]M}[\square/`a])[`b/`g] & [] \\
    \triangleq & \tr{[`d]M}[\square/`a])[`b/`g] & p:[] \\
    \triangleq & (\psc\ `d\ M[\square/`a][`b/`g] & p:[] \\
    \triangleq & \psc\ `b\ (M[\square/`a])[`b/`g] & p:[] \\
    \triangleq & \tr{`m`a.[`b](M[`b/`g])} & p:[]
\end{array}
\]
\\ 
% TODO: verify that this is correct
\[
\begin{array}{rlrl}
  \prooflabel{(`m`d.[`a]M)[[`a]M^\prime N/[`a]M^\prime]
    \to (`m`d.[`a](M[[`a]M^\prime N/[`a]M^\prime])} \\
               & \tr{(`m`d.[`a]M)[[`g]M^\prime N/[`a]M^\prime]} \\
    \triangleq & (\wsc\ p\ `l`d.\pp\ p\ (\psc\ `a\ M))[\square N/`a] \\
    \tob\      & \wsc\ p\ `l`d.\pp\ p\ (\psc\ \square N\ (M[\square N/`a]))) \\
    \triangleq & \tr{`m`d.[`a](M[[`a]M^\prime N/[`a]M^\prime])} \\
\end{array}
\]
\\ 
% TODO: verify that this is correct
\[
\begin{array}{rlrl}
  \prooflabel{M[[`a]M^\prime N/[`a]M] \to M \hspace{10pt} (`a \not\in \fn(M)):} \\
               & \tr{M[[`a]M^\prime N/[`a]M]} \\
    \triangleq & \tr{M}[\square N/`a] \\
    \tob\      & \tr{M} & (`a \not\in \fv(M))
\end{array}
\]
\end{proof}

\section{\ltry-to-DCC}

  If we append the translation of \ltry\ into $`l`m$ with the translating of
  $`l`m$ to DCC, we get a translation from \lam-calculus to DCC:

  % TODO: add lines over (catch n(x) = L)
  \definition{
    \textsc{Translation of \ltry\ into DCC}
    \[
    \begin{array}{rcl}
      \tr{x} & \triangleq & x \\
      \tr{`lx.M} & \triangleq & `lx.\tr{M} \\
      \tr{MN} & \triangleq & \tr{M} \tr{N} \\
      
      \tr{\throw{n($M$)}} & \triangleq & \wsc\ p\ `l\nonocc.\pp\ p\ (psc\ n\ (c\ \tr{M})) \\ 
      \tr{\try M;\ \catch{n($x$) = $L$}}
        &
        \triangleq 
        &
        (`lc.\wsc\ p\ `ln.\pp\ p\ (\psc\ n\ \tr{M}))(`lx.\tr{L})
      \\ 
      %\multicolumn{3}{l}{\tr{\try M;\ \catch{n$_i$($x$) = $M_i$};\ \catch{m($x$) = $L$}}} \\
      \multicolumn{3}{l}{\tr{\try M;\ \mcatch;\ \catch{m($x$) = $L$}}} \\
        & \triangleq \\
      \multicolumn{3}{r}{
        %(`lc.\wsc\ p\ `lm.\pp\ p\ (\psc\ m\ \tr{\try M;\ \catch{n$_i$($x$) = $M_i$}}))(`lx.\tr{L})
        (`lc.\wsc\ p\ `lm.\pp\ p\ (\psc\ m\ \tr{\try M;\ \mcatch}))(`lx.\tr{L})
      }
    \end{array} 
    \]
  }
